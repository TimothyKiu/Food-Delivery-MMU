<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Map with Marker</title>
<style>
    #map {
        height: 600px;
        width: 100%;
    }
</style>
</head>
<body>

<div id="map"></div>
<button onclick="updateLocation()">Update Location</button>

<script>
let map;
let marker;

function initMap(latitude, longitude) {
    // Create a new map centered at the specified latitude and longitude
    map = new google.maps.Map(document.getElementById("map"), {
        zoom: 15,
        center: { lat: latitude, lng: longitude },
    });

    // Create a marker at the specified location
    marker = new google.maps.Marker({
        position: { lat: latitude, lng: longitude },
        map: map,
        title: "Your Location"
    });
}

function updateMarkerPosition(latitude, longitude) {
    // Update the position of the marker
    marker.setPosition({ lat: latitude, lng: longitude });

    // Center the map to the new position
    map.setCenter({ lat: latitude, lng: longitude });
}

function updateLocation() {
    fetch('/get_location')
        .then(response => response.json())
        .then(data => {
            if (data.latitude && data.longitude) {
                updateMarkerPosition(data.latitude, data.longitude);
            } else {
                alert('No location data available');
            }
        })
        .catch(error => console.error('Error fetching location data:', error));
}

// Fetch the initial coordinates from the server and initialize the map
fetch('/get_location')
    .then(response => response.json())
    .then(data => {
        if (data.latitude && data.longitude) {
            initMap(data.latitude, data.longitude);
            // Set an interval to update the location every 5 seconds
            setInterval(updateLocation, 5000);
        } else {
            alert('No initial location data available');
        }
    })
    .catch(error => console.error('Error fetching initial location data:', error));
</script>

<!-- Include the Google Maps JavaScript API with your API key -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBMr9hac9m2PJhb9oQHzbMsTdxlLNzB0A&callback=initMap" async defer></script>

</body>
</html>
